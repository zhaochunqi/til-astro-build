---
import { getCollection } from "astro:content";
import NotesList from "../../components/NotesList.astro";
import Layout from "../../layouts/Layout.astro";
import { sortNotesByUlid } from "../../utils/sort";

export async function getStaticPaths() {
	const notes = await getCollection("notes");
	const uniqueTags = [
		...new Set(notes.flatMap((note) => note.data.tags || [])),
	];

	return uniqueTags.map((tag) => {
		const filteredNotes = notes.filter((note) => note.data.tags?.includes(tag));
		return {
			params: { tag },
			props: { notes: filteredNotes },
		};
	});
}

const { tag } = Astro.params;
const { notes } = Astro.props;
const sortedNotes = sortNotesByUlid(notes);
---

<Layout title={`Tag: ${tag} - TIL`}>
  <section class="space-y-6">
    <div class="flex flex-col space-y-2 max-w-4xl mx-auto">
      <h1 class="text-3xl font-bold tracking-tighter sm:text-4xl md:text-5xl">Tag: {tag}</h1>
      <p class="text-muted-foreground text-lg">
        {notes.length} {notes.length === 1 ? 'note' : 'notes'} found.
      </p>
    </div>
    <NotesList notes={sortedNotes} />
  </section>
</Layout>
