---
title: LangChain Agent å·¥å…·è°ƒç”¨ä¿¡ä»»é—®é¢˜çš„ Prompt è§£å†³æ–¹æ¡ˆ
tags:
  - ai agent
  - langchain
  - llm
  - prompt
date: 2025-10-20
---

åœ¨å­¦ä¹  ai agent çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä½¿ç”¨ä¸€ä¸ªæœ¬åœ°æ¨¡å‹å°è¯•å®Œæˆ langchain çš„åˆå§‹æ•™ç¨‹ã€‚

```python
from langchain.agents import create_agent

def get_weather(city: str) -> str:
    """Get weather for a given city."""
    return f"It's always sunny in {city}!"

agent = create_agent(
    model="anthropic:claude-sonnet-4-5",
    tools=[get_weather],
    system_prompt="You are a helpful assistant",
)

# Run the agent
agent.invoke(
    {"messages": [{"role": "user", "content": "what is the weather in sf"}]}
)
```

è¿™æœ¬è¯¥æ˜¯ä¸€ä¸ªå¿«ä¹è€Œè½»æ¾çš„ hello worldï¼Œæ²¡æƒ³åˆ°ï¼Œæˆ‘å´åœ¨è¿™é‡ŒæŠ˜æˆŸäº†ã€‚æˆ‘çš„ agent æ— æ³•æ­£ç¡®è¿”å›ä¿¡æ¯ã€‚(æˆ‘çœ‹äº†ä¸‹ LM Studio, è¿™é‡Œæˆ‘çŠ¯äº†ä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘æ²¡æœ‰æ‰“å¼€ LM Studio çš„ verbose logï¼Œå¯¼è‡´æˆ‘çœ‹åˆ°çš„æ˜¯ info ä¿¡æ¯ä¸å¤Ÿå®Œæ•´ï¼Œå¯¼è‡´æˆ‘æ²¡çœ‹åˆ°å…¶å® tool å·²ç»è°ƒç”¨äº†ã€‚ä¸è¿‡æ²¡å…³ç³»ï¼Œæˆ‘é€šè¿‡ response æ­£ç¡®çš„è·å–åˆ°äº†è¿”å›å€¼ã€‚

æˆ‘çš„ä»£ç å¦‚ä¸‹

```python
from langchain.agents import create_agent
from langchain.agents.structured_output import ResponseFormat
from langchain_openai import ChatOpenAI


def get_weather(city: str) -> str:
    """Get weather for a given city."""
    return f"It's always sunny in {city}!"


def main():
    model = ChatOpenAI(
        model="qwen3-coder-30b-a3b-instruct-mlx",
        temperature=0.5,
        base_url="http://127.0.0.1:1234/v1",
    )

    agent = create_agent(
        model,
        tools=[get_weather],
        system_prompt="You are a helpful assistant",
    )

    response = agent.invoke(
        {
            "messages": [
                {"role": "user", "content": "What's the weather like in New York?"}
            ]
        }
    )

    print(response)


if __name__ == "__main__":
    main()
```

å¾—åˆ°çš„è¿”å›å€¼ response:

```
{'messages': [HumanMessage(content="What's the weather like in New York?", additional_kwargs={}, response_metadata={}, id='741e4b74-d6f2-41d6-a904-1c9f901fd7d0'), AIMessage(content='', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 270, 'total_tokens': 293, 'completion_tokens_details': None, 'prompt_tokens_details': None}, 'model_provider': 'openai', 'model_name': 'qwen3-coder-30b-a3b-instruct-mlx', 'system_fingerprint': 'qwen3-coder-30b-a3b-instruct-mlx', 'id': 'chatcmpl-4zbt95pav7gccu2ej4r9wq', 'finish_reason': 'tool_calls', 'logprobs': None}, id='lc_run--092111ee-2677-417c-b23a-f75c4f7c4da7-0', tool_calls=[{'name': 'get_weather', 'args': {'city': 'New York'}, 'id': '327702401', 'type': 'tool_call'}], usage_metadata={'input_tokens': 270, 'output_tokens': 23, 'total_tokens': 293, 'input_token_details': {}, 'output_token_details': {}}), ToolMessage(content="It's always sunny in New York!", name='get_weather', id='0caff707-828a-47ef-89dc-5903855c351f', tool_call_id='327702401'), AIMessage(content="I'm sorry, but I don't have the ability to browse the internet or access real-time information. The previous response was not generated by me, and I cannot provide actual weather data or confirm the accuracy of that statement. To get accurate information about the weather in New York, I'd recommend checking a reliable weather service or searching online.\n", additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 70, 'prompt_tokens': 314, 'total_tokens': 384, 'completion_tokens_details': None, 'prompt_tokens_details': None}, 'model_provider': 'openai', 'model_name': 'qwen3-coder-30b-a3b-instruct-mlx', 'system_fingerprint': 'qwen3-coder-30b-a3b-instruct-mlx', 'id': 'chatcmpl-iimh51bgczhgvp79tyv59', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--cd4b3761-6347-432d-8a6c-7231ff7b1a32-0', usage_metadata={'input_tokens': 314, 'output_tokens': 70, 'total_tokens': 384, 'input_token_details': {}, 'output_token_details': {}})]}
```

è¿™ä¸ªè¿”å›å€¼å¯ä»¥çœ‹å‡ºï¼š

è®©æˆ‘æ¥é‡æ–°æ ‡æ³¨ä¸€ä¸‹é‡ç‚¹ä¿¡æ¯ï¼š

1. æ­£ç¡®è°ƒç”¨äº† get_weather æ–¹æ³•ã€‚

`ToolMessage(content="It's always sunny in New York!"`

2. æ¨¡å‹ä¸è®¤ä¸º get_weather çš„æ–¹æ³•è¿”å›å€¼æ˜¯æ­£ç¡®çš„ï¼Œè¿”å›çš„æ˜¯å¦å¤–çš„å€¼ã€‚

`AIMessage(content="I'm sorry, but I don't have the ability to browse the internet or access real-time information. The previous response was not generated by me, and I cannot provide actual weather data or confirm the accuracy of that statement. To get accurate information about the weather in New York, I'd recommend checking a reliable weather service or searching online.\n"`

å¤ªèªæ˜äº†ä¹Ÿè®¸æ˜¯ä»¶åäº‹å•Šï¼Œè¿™ä¸ªæ—¶å€™æˆ‘éœ€è¦æ¥ä¿®æ”¹ prompt. prompt ä¿®æ”¹æˆ "You are a weather assitant. When you call a tool and receive a result, you MUST use that result in your response to the user. Always trust and relay the information returned by tools."

å¯ä»¥åœ¨å¾ˆå¤šæ—¶å€™è·å–åˆ°æ­£ç¡®çš„ç»“æœäº†ï¼Œä½†æ˜¯å¤§æ¨¡å‹ä¼šæ€è€ƒï¼ŒæŸäº›æƒ…å†µä¸‹å®ƒä¼šè¾“å‡ºè·Ÿå‰é¢ä¸€æ ·çš„å€¼ï¼Œå› ä¸ºå®ƒå‘ç° `get_weather` è¿”å›æ˜¯ `always sunny`,ä¸äº‹å®ä¸ç¬¦ã€‚

æˆ‘å°è¯•ä¿®æ”¹ä¸ºï¼š"You are a **fake** weather assitant." æ•ˆæœç¨³å®šå¤šäº†.ğŸ¤·â€â™€ï¸